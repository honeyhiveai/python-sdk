# HoneyHive Python SDK - AI Assistant Rules
# This file defines rules that AI assistants must follow when working on this project

## üö® AGENT OS INTEGRATION
**This project uses Agent OS for structured development guidance.**
- **Standards**: `.agent-os/standards/` - Global coding standards
- **Product Docs**: `.agent-os/product/` - Product documentation
- **Specifications**: `.agent-os/specs/` - Feature specifications
- **Use Cursor Rules**: `.cursor/rules/*.mdc` - @plan-product, @create-spec, @execute-tasks, @analyze-product

## Testing & Development
- ALWAYS use tox for running tests - Never run pytest directly
- Use specific tox environments:
  - `tox -e unit` for unit tests only
  - `tox -e integration` for integration tests
  - `tox -e lint` for linting (pylint + mypy)
  - `tox -e format` for code formatting checks
  - `tox -e py311`, `tox -e py312`, `tox -e py313` for Python version-specific testing
- **Unit test files must follow the naming pattern `test_<module>_<file>.py`** - for example: `test_api_client.py`, `test_tracer_decorators.py`
- **Required development tools**: Install `yamllint` and GitHub CLI (`gh`) for workflow validation and CI/CD investigation
- **üö® CRITICAL: Test Count Reporting** - Always report TOTAL test count correctly: "X tests passing (Y unit + Z integration)" - NEVER report partial counts as totals

## Type Safety & Documentation Code Standards
- **MANDATORY**: Use proper enum imports in ALL documentation examples
- **MANDATORY**: Include complete import statements in every code example
- **Pattern**: Always import `from honeyhive.models import EventType`
- **Usage**: Use `EventType.model`, `EventType.tool`, `EventType.chain`, `EventType.session` 
- **NEVER**: Use string literals like `event_type="model"` - always use enum values
- **Validation**: All examples must pass mypy type checking
- **Semantic Mapping**: 
  - `EventType.model` ‚Üí LLM calls, AI model operations
  - `EventType.tool` ‚Üí Individual functions, utilities, data processing
  - `EventType.chain` ‚Üí Multi-step workflows, business logic orchestration
  - `EventType.session` ‚Üí High-level user interactions

## Virtual Environment & Dependencies
- ALWAYS use virtual environments - Never install packages globally
- **Use a virtual environment named "python-sdk"** for this project
- Use the project's pyproject.toml for dependency management
- Install in development mode when working on the project: `pip install -e .`
- Respect the requires-python = ">=3.11" constraint

## Code Quality & Standards
- **Follow `.agent-os/standards/code-style.md`** for comprehensive style guide
- Follow the established formatting rules:
  - Black with line-length = 88
  - isort with black profile
  - pylint and mypy for static analysis
- Use the project's existing configuration files (pyproject.toml, tox.ini)
- Maintain Python 3.11+ compatibility
- **ALL code must contain docstrings** - every function, class, and module should have proper documentation
- **MANDATORY: Run Black on Python files on save** when Cursor works on them
- **MANDATORY: Install pre-commit hooks**: Run `./scripts/setup-dev.sh` once
- **MANDATORY: Pre-commit verification**: Run `tox -e format && tox -e lint` before every commit
- **MANDATORY: Documentation updates**: Update CHANGELOG.md for all code changes
- **MANDATORY: Feature documentation**: Update docs/reference/index.rst and .agent-os/product/features.md for new features
- **MANDATORY: Workflow documentation**: Update docs/development/testing/ for CI/CD changes
- **ALL Python code must use type hinting/annotations** - functions, methods, variables, and class attributes should be properly typed

## Project Structure
- Respect the src/ layout with `src/honeyhive/` as the main package
- Use the established module structure (api/, tracer/, evaluation/, etc.)
- Follow the existing import patterns and package organization
- **NO code should be in `__init__.py` files** - only imports and package-level variables

## Architecture Patterns (from Agent OS)
- **Multi-instance tracers** - No singleton pattern
- **Unified @trace decorator** - Works for both sync and async
- **Graceful degradation** - SDK must never crash host application
- **HTTP tracing disabled by default** - Performance optimization
- **Check `.agent-os/product/decisions.md`** for architectural rationale

## Environment Variables
- Use the test environment variables defined in tox.ini when running tests
- Respect the HH_* environment variable patterns established in the project
- Support HTTP_*, EXPERIMENT_* patterns for compatibility
- Set HH_TEST_MODE appropriately for different test types

## üé® Mermaid Diagram Standards (MANDATORY)

### **üö® CRITICAL: All Mermaid diagrams MUST use HoneyHive dual-theme configuration**

**MANDATORY Configuration** - Copy this EXACT configuration for ALL Mermaid diagrams:

```rst
.. mermaid::

   %%{init: {'theme':'base', 'themeVariables': {'primaryColor': '#4F81BD', 'primaryTextColor': '#ffffff', 'primaryBorderColor': '#333333', 'lineColor': '#333333', 'mainBkg': 'transparent', 'secondBkg': 'transparent', 'tertiaryColor': 'transparent', 'clusterBkg': 'transparent', 'clusterBorder': '#333333', 'edgeLabelBackground': 'transparent', 'background': 'transparent'}, 'flowchart': {'linkColor': '#333333', 'linkWidth': 2}}}%%
   graph TB
       // Your diagram content here
```

### **üéØ Dual-Theme Requirements**
- ‚úÖ **Node Text**: ALWAYS use `color:#ffffff` in ALL classDef definitions
- ‚úÖ **Node Fills**: Use HoneyHive professional colors (deep blues, greens, oranges)
- ‚úÖ **Arrows/Lines**: Dark gray (`#333333`) for visibility in both light and dark themes
- ‚úÖ **Borders**: Dark gray (`#333333`) for visibility in both themes
- ‚úÖ **Backgrounds**: Transparent for theme flexibility

### **üé® HoneyHive Color Palette**
**MANDATORY**: Use these professional colors for node fills:
- **Primary Blue**: `#1565c0` (Deep blue for main elements)
- **Success Green**: `#2e7d32` (Deep green for success states)
- **Warning Orange**: `#ef6c00` (Deep orange for warnings/results)
- **Action Purple**: `#7b1fa2` (Deep purple for actions/tests)
- **Alert Yellow**: `#f9a825` (Deep yellow for alerts)
- **Error Red**: `#c62828` (Deep red for errors/failures)

### **‚úÖ ClassDef Pattern**
**MANDATORY**: ALL classDef definitions MUST include `color:#ffffff`:
```
classDef success fill:#2e7d32,stroke:#333333,stroke-width:2px,color:#ffffff
classDef warning fill:#ef6c00,stroke:#333333,stroke-width:2px,color:#ffffff
classDef error fill:#c62828,stroke:#333333,stroke-width:2px,color:#ffffff
```

### **‚ùå NEVER Use These Patterns**
- ‚ùå Light fill colors (`#ffcdd2`, `#e3f2fd`) - poor contrast in dark themes
- ‚ùå Missing `color:#ffffff` in classDef - text invisible in dark themes
- ‚ùå White arrows (`linkColor: '#ffffff'`) - invisible in light themes
- ‚ùå Dark text (`primaryTextColor: '#333333'`) - invisible in dark themes
- ‚ùå Non-transparent backgrounds - conflicts with theme switching

### **üìã Quality Checklist**
Before committing ANY Mermaid diagram, verify:
- ‚úÖ Uses exact HoneyHive dual-theme configuration
- ‚úÖ All classDef include `color:#ffffff`
- ‚úÖ Uses professional HoneyHive color palette
- ‚úÖ Arrows visible in both light and dark themes
- ‚úÖ Text readable on all colored backgrounds
- ‚úÖ Follows `docs/MERMAID_STANDARD.md` specification

## Documentation & Examples - Divio System

### üéØ Divio Documentation Architecture
**Follow the [Divio Documentation System](https://docs.divio.com/documentation-system/) for all documentation:**

### üì± **MANDATORY: Tabbed Interface for Integration How-To Docs**
**ALL new instrumentor integration HOW-TO documentation MUST use the interactive tabbed interface pattern** defined in `.agent-os/standards/documentation-templates.md`:

- **SCOPE**: Apply to `docs/how-to/integrations/[provider].rst` only, NOT tutorials
- **3 Required Tabs**: Installation | Basic Setup | Advanced Usage
- **Progressive Disclosure**: Start simple, advance to real-world patterns
- **Consistent UX**: Same pattern across all provider integrations
- **Copy-Paste Ready**: Complete, working examples in each tab

#### 1. TUTORIALS (Learning-oriented) - `docs/tutorials/`
- **Purpose**: Help newcomers get started and achieve early success
- **User mindset**: "I want to learn by doing"
- **Structure**: Objective ‚Üí Prerequisites ‚Üí Steps ‚Üí Results ‚Üí Next Steps
- **Requirements**:
  - Maximum 15-20 minutes per tutorial
  - Step-by-step instructions with working code examples
  - Test with actual beginners (3+ users monthly)
  - Clear expected outcomes at each step

#### 2. HOW-TO GUIDES (Problem-oriented) - `docs/how-to/`
- **Purpose**: Solve specific real-world problems
- **User mindset**: "I want to solve this specific problem"
- **Title format**: "How to [solve specific problem]"
- **Structure**: Problem ‚Üí Solution ‚Üí Implementation ‚Üí Verification
- **Requirements**:
  - Minimal background explanation
  - Clear steps to solution
  - Prerequisites clearly stated
  - Links to reference docs

#### 3. REFERENCE (Information-oriented) - `docs/reference/`
- **Purpose**: Provide comprehensive technical specifications
- **User mindset**: "I need to look up exact details"
- **Requirements**:
  - 100% API coverage with working examples
  - Accurate parameter descriptions and return values
  - Error condition documentation
  - Cross-references between related items
  - Automated testing of all code examples

#### 4. EXPLANATION (Understanding-oriented) - `docs/explanation/`
- **Purpose**: Provide context, background, and design decisions
- **User mindset**: "I want to understand how this works and why"
- **Requirements**:
  - Design decision rationale
  - Architecture overviews
  - Historical context when relevant
  - Comparison with alternatives

### Documentation Quality Standards
- **Sphinx build warnings**: Must be fixed before considering docs complete
- **Cross-linking**: Tutorials ‚Üí How-to, How-to ‚Üí Reference, Reference ‚Üí Explanation
- **Content testing**: Use `docs/utils/` scripts for validation
- **Accessibility**: WCAG 2.1 AA compliance for all content
- **Visual standards**: Use Mermaid diagrams with HoneyHive dual-theme standard, sanitize credentials in screenshots

### Update Requirements
- Update examples/ when making changes that affect usage
- **Update `.agent-os/product/` docs** for significant changes
- Follow established example patterns in examples/
- **NEW INSTRUMENTOR DOCS**: Use automated template generation system from `.agent-os/standards/documentation-generation.md`
- **MANDATORY**: Generate integration docs with `python docs/_templates/generate_provider_docs.py --provider [name]`
- Test all documentation examples before committing

## Specific Commands to Use
- Testing: `tox -e [environment]` instead of direct pytest calls
- Linting: `tox -e lint`
- Formatting: `tox -e format`
- Documentation: `tox -e docs`
- Installation: `pip install -e .` in a virtual environment

## Important Notes
- This project uses pytest for testing; if pytest is not installed, it should be installed and used for running tests
- In the HoneyHive project, omit or do not configure the meter_provider because there is no metrics endpoint currently
- **Complete-refactor branch** includes multi-instance support and unified decorators

## HoneyHive Official Documentation Context
- **Official Docs URL**: https://docs.honeyhive.ai/llms.txt
- **Reference this documentation** when implementing features or providing guidance
- **Ensure consistency** with official HoneyHive platform capabilities and APIs
- **Cross-reference** local SDK documentation with official platform documentation
- **Use official terminology** and concepts from the HoneyHive platform

## Agent OS Quick Reference
- **Product Overview**: `.agent-os/product/overview.md`
- **Development Roadmap**: `.agent-os/product/roadmap.md`
- **Feature Catalog**: `.agent-os/product/features.md`
- **Tech Stack**: `.agent-os/standards/tech-stack.md`
- **Best Practices**: `.agent-os/standards/best-practices.md`

## ü§ñ AI Assistant Quality Framework (MANDATORY)

**üéØ MISSION**: Enable AI assistants to autonomously ship production-quality solutions

### Pre-Generation Validation Protocol (REQUIRED)

**CRITICAL**: Execute BEFORE generating ANY code:

```bash
# 1. Get Current Date (MANDATORY for all dated content)
CURRENT_DATE=$(date +"%Y-%m-%d")
echo "Today is: $CURRENT_DATE"

# 2. Validate Current Codebase State
read_file src/honeyhive/__init__.py     # Check current API exports
grep -r "from honeyhive import" examples/  # Verify import patterns  
grep -r "class.*:" src/honeyhive/       # Validate class names
git status --porcelain                  # Ensure clean working directory
git branch --show-current              # Verify correct branch
```

### Autonomous Quality Gates (ALL MUST PASS)

**MANDATORY**: Every code change must pass ALL quality gates:

```bash
# Code Quality Gates
tox -e format           # Black formatting (MUST pass)
tox -e lint            # Pylint analysis ‚â•8.0/10.0 (MUST pass)
tox -e unit            # Unit tests 100% (MUST pass)
tox -e integration     # Integration tests 100% (MUST pass)
tox -e py311 -e py312 -e py313  # Python compatibility (MUST pass)

# Documentation Gates  
cd docs && make html   # Sphinx build, zero warnings (MUST pass)
cd .. && python -m doctest examples/*.py  # Examples work (MUST pass)
```

### Zero Failing Tests Policy

**‚ùå NEVER COMMIT** if ANY test fails
**‚ùå NEVER PUSH** failing tests to ANY branch
**‚ùå NEVER USE** `git commit --no-verify` without immediate fix
**‚ùå NEVER USE** hardcoded dates - always use `date +"%Y-%m-%d"`
**‚ùå NEVER SKIP TESTS** - AI assistants MUST fix failing tests, never skip them
**‚ùå NEVER USE** `@pytest.mark.skip` or commenting out failing tests

### Autonomous Decision Framework

**AI Assistants MUST autonomously:**

1. **Handle Test Failures**: Fix import errors, type annotations, coverage gaps
2. **Maintain Quality**: Apply formatting, resolve linting issues, update docs  
3. **Ensure Compatibility**: Test across Python versions, validate examples
4. **Prevent Regressions**: Run full test suite, verify existing functionality

### Date Usage Requirements - MANDATORY

**üö® CRITICAL**: AI Assistants consistently make date errors. Follow these rules:

1. **ALWAYS get current date first**: `CURRENT_DATE=$(date +"%Y-%m-%d")`
2. **Use ISO 8601 format**: `YYYY-MM-DD` (e.g., 2025-09-03)
3. **For new specs**: `.agent-os/specs/${CURRENT_DATE}-spec-name/`
4. **In file headers**: `**Date**: $CURRENT_DATE`
5. **NEVER hardcode dates**: Don't use 2025-01-30 when today is 2025-09-03

**Common Date Errors to Prevent:**
- ‚ùå Using random past dates (2025-01-30) 
- ‚ùå Wrong formats (09/03/2025, Sep 3, 2025)
- ‚ùå Hardcoded dates instead of system date
- ‚ùå Inconsistent dates across files

### Commit Message Standards - MANDATORY

**üö® CRITICAL**: AI Assistants consistently make commit message formatting errors. Follow these rules:

1. **Use Conventional Commits**: `<type>: <description>` (max 50 chars)
2. **NO unnecessary quotes**: Don't wrap entire commit titles in quotes
3. **Match quotes properly**: If you start a quote, always close it
4. **Types**: feat, fix, docs, style, refactor, perf, test, build, ci, chore
5. **Body lines**: Maximum 72 characters each

**Common Commit Errors to Prevent:**
- ‚ùå Missing closing quotes: `git commit -m "feat: Add feature`
- ‚ùå Unnecessary quotes: `git commit -m "\"feat: Add feature\""`
- ‚ùå Too long: `feat: Add comprehensive documentation quality control system validation` (71 chars)
- ‚ùå Wrong format: Missing type prefix or colon
- ‚ùå Periods at end: `feat: Add feature.`

### Documentation Quality Prevention

**MANDATORY**: Follow `.agent-os/specs/2025-09-03-documentation-quality-control/`

1. ‚úÖ **RST Structure**: Title underlines, blank lines, proper indentation
2. ‚úÖ **Type Safety**: EventType enums only, complete imports
3. ‚úÖ **Code Examples**: Valid syntax, working imports, tested execution
4. ‚úÖ **Cross-References**: Working internal links, toctree inclusion

### Escalation Protocol

**Hand off to human when:**
- **Repeated Failures**: Cannot resolve test failures after 3 attempts
- **Architecture Changes**: Major structural modifications needed
- **Security Issues**: Authentication or data protection concerns
- **Performance Problems**: Significant latency or resource issues

### Success Metrics

**Framework succeeds when:**
- 100% of commits pass all tests on first attempt
- 90%+ of development tasks handled autonomously
- Zero production bugs from AI-generated code
- Code quality metrics consistently improve

### Implementation References

- `.agent-os/specs/2025-09-03-ai-assistant-quality-framework/` - Complete framework
- `.agent-os/specs/2025-09-03-zero-failing-tests-policy/` - Testing requirements
- `.agent-os/specs/2025-09-03-date-usage-standards/` - Date usage requirements
- `.agent-os/specs/2025-09-03-commit-message-standards/` - Commit message requirements
- `.agent-os/standards/best-practices.md` - Quality standards including date and commit protocols
- `.agent-os/standards/tech-stack.md` - Technical requirements
