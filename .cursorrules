# HoneyHive Python SDK - AI Assistant Rules
# This file defines rules that AI assistants must follow when working on this project

## üö® AGENT OS INTEGRATION
**This project uses Agent OS for structured development guidance.**
- **Standards**: `.agent-os/standards/` - Global coding standards
- **Product Docs**: `.agent-os/product/` - Product documentation
- **Specifications**: `.agent-os/specs/` - Feature specifications
- **Use Cursor Rules**: `.cursor/rules/*.mdc` - @plan-product, @create-spec, @execute-tasks, @analyze-product

## Testing & Development
- ALWAYS use tox for running tests - Never run pytest directly
- Use specific tox environments:
  - `tox -e unit` for unit tests only
  - `tox -e integration` for integration tests
  - `tox -e lint` for linting (pylint + mypy)
  - `tox -e format` for code formatting checks
  - `tox -e py311`, `tox -e py312`, `tox -e py313` for Python version-specific testing
- **Unit test files must follow the naming pattern `test_<module>_<file>.py`** - for example: `test_api_client.py`, `test_tracer_decorators.py`
- **Required development tools**: Install `yamllint` and GitHub CLI (`gh`) for workflow validation and CI/CD investigation

## Type Safety & Documentation Code Standards
- **MANDATORY**: Use proper enum imports in ALL documentation examples
- **MANDATORY**: Include complete import statements in every code example
- **Pattern**: Always import `from honeyhive.models import EventType`
- **Usage**: Use `EventType.model`, `EventType.tool`, `EventType.chain`, `EventType.session` 
- **NEVER**: Use string literals like `event_type="model"` - always use enum values
- **Validation**: All examples must pass mypy type checking
- **Semantic Mapping**: 
  - `EventType.model` ‚Üí LLM calls, AI model operations
  - `EventType.tool` ‚Üí Individual functions, utilities, data processing
  - `EventType.chain` ‚Üí Multi-step workflows, business logic orchestration
  - `EventType.session` ‚Üí High-level user interactions

## Virtual Environment & Dependencies
- ALWAYS use virtual environments - Never install packages globally
- **Use a virtual environment named "python-sdk"** for this project
- Use the project's pyproject.toml for dependency management
- Install in development mode when working on the project: `pip install -e .`
- Respect the requires-python = ">=3.11" constraint

## Code Quality & Standards
- **Follow `.agent-os/standards/code-style.md`** for comprehensive style guide
- Follow the established formatting rules:
  - Black with line-length = 88
  - isort with black profile
  - pylint and mypy for static analysis
- Use the project's existing configuration files (pyproject.toml, tox.ini)
- Maintain Python 3.11+ compatibility
- **ALL code must contain docstrings** - every function, class, and module should have proper documentation
- **MANDATORY: Run Black on Python files on save** when Cursor works on them
- **MANDATORY: Install pre-commit hooks**: Run `./scripts/setup-dev.sh` once
- **MANDATORY: Pre-commit verification**: Run `tox -e format && tox -e lint` before every commit
- **MANDATORY: Documentation updates**: Update CHANGELOG.md for all code changes
- **MANDATORY: Feature documentation**: Update docs/FEATURE_LIST.rst and .agent-os/product/features.md for new features
- **MANDATORY: Workflow documentation**: Update docs/TESTING.rst for CI/CD changes
- **ALL Python code must use type hinting/annotations** - functions, methods, variables, and class attributes should be properly typed

## Project Structure
- Respect the src/ layout with `src/honeyhive/` as the main package
- Use the established module structure (api/, tracer/, evaluation/, etc.)
- Follow the existing import patterns and package organization
- **NO code should be in `__init__.py` files** - only imports and package-level variables

## Architecture Patterns (from Agent OS)
- **Multi-instance tracers** - No singleton pattern
- **Unified @trace decorator** - Works for both sync and async
- **Graceful degradation** - SDK must never crash host application
- **HTTP tracing disabled by default** - Performance optimization
- **Check `.agent-os/product/decisions.md`** for architectural rationale

## Environment Variables
- Use the test environment variables defined in tox.ini when running tests
- Respect the HH_* environment variable patterns established in the project
- Support HTTP_*, EXPERIMENT_* patterns for compatibility
- Set HH_TEST_MODE appropriately for different test types

## Documentation & Examples - Divio System

### üéØ Divio Documentation Architecture
**Follow the [Divio Documentation System](https://docs.divio.com/documentation-system/) for all documentation:**

#### 1. TUTORIALS (Learning-oriented) - `docs/tutorials/`
- **Purpose**: Help newcomers get started and achieve early success
- **User mindset**: "I want to learn by doing"
- **Structure**: Objective ‚Üí Prerequisites ‚Üí Steps ‚Üí Results ‚Üí Next Steps
- **Requirements**:
  - Maximum 15-20 minutes per tutorial
  - Step-by-step instructions with working code examples
  - Test with actual beginners (3+ users monthly)
  - Clear expected outcomes at each step

#### 2. HOW-TO GUIDES (Problem-oriented) - `docs/how-to/`
- **Purpose**: Solve specific real-world problems
- **User mindset**: "I want to solve this specific problem"
- **Title format**: "How to [solve specific problem]"
- **Structure**: Problem ‚Üí Solution ‚Üí Implementation ‚Üí Verification
- **Requirements**:
  - Minimal background explanation
  - Clear steps to solution
  - Prerequisites clearly stated
  - Links to reference docs

#### 3. REFERENCE (Information-oriented) - `docs/reference/`
- **Purpose**: Provide comprehensive technical specifications
- **User mindset**: "I need to look up exact details"
- **Requirements**:
  - 100% API coverage with working examples
  - Accurate parameter descriptions and return values
  - Error condition documentation
  - Cross-references between related items
  - Automated testing of all code examples

#### 4. EXPLANATION (Understanding-oriented) - `docs/explanation/`
- **Purpose**: Provide context, background, and design decisions
- **User mindset**: "I want to understand how this works and why"
- **Requirements**:
  - Design decision rationale
  - Architecture overviews
  - Historical context when relevant
  - Comparison with alternatives

### Documentation Quality Standards
- **Sphinx build warnings**: Must be fixed before considering docs complete
- **Cross-linking**: Tutorials ‚Üí How-to, How-to ‚Üí Reference, Reference ‚Üí Explanation
- **Content testing**: Use `docs/utils/` scripts for validation
- **Accessibility**: WCAG 2.1 AA compliance for all content
- **Visual standards**: Use Mermaid diagrams with base theme, sanitize credentials in screenshots

### Update Requirements
- Update examples/ when making changes that affect usage
- **Update `.agent-os/product/` docs** for significant changes
- Follow established example patterns in examples/
- Test all documentation examples before committing

## Specific Commands to Use
- Testing: `tox -e [environment]` instead of direct pytest calls
- Linting: `tox -e lint`
- Formatting: `tox -e format`
- Documentation: `tox -e docs`
- Installation: `pip install -e .` in a virtual environment

## Important Notes
- This project uses pytest for testing; if pytest is not installed, it should be installed and used for running tests
- In the HoneyHive project, omit or do not configure the meter_provider because there is no metrics endpoint currently
- **Complete-refactor branch** includes multi-instance support and unified decorators

## HoneyHive Official Documentation Context
- **Official Docs URL**: https://docs.honeyhive.ai/llms.txt
- **Reference this documentation** when implementing features or providing guidance
- **Ensure consistency** with official HoneyHive platform capabilities and APIs
- **Cross-reference** local SDK documentation with official platform documentation
- **Use official terminology** and concepts from the HoneyHive platform

## Agent OS Quick Reference
- **Product Overview**: `.agent-os/product/overview.md`
- **Development Roadmap**: `.agent-os/product/roadmap.md`
- **Feature Catalog**: `.agent-os/product/features.md`
- **Tech Stack**: `.agent-os/standards/tech-stack.md`
- **Best Practices**: `.agent-os/standards/best-practices.md`

## ü§ñ AI Assistant Validation Protocol (MANDATORY)

**‚ö†Ô∏è CRITICAL**: Before generating ANY code that integrates with the codebase:

### Pre-Generation Validation (REQUIRED)
1. **Check Current API**: `read_file src/honeyhive/__init__.py` 
2. **Verify Imports**: `grep -r "from honeyhive import" examples/`
3. **Validate Classes**: Ensure class names match current exports

### Documentation Quality Prevention (NEW)
**MANDATORY**: Follow `.agent-os/specs/2025-01-30-documentation-quality-prevention/`

1. ‚úÖ **RST Structure**: Title underlines, blank lines, proper indentation
2. ‚úÖ **Type Safety**: EventType enums only, complete imports
3. ‚úÖ **Code Examples**: Valid syntax, working imports, tested execution
4. ‚úÖ **Structure**: Toctree inclusion, working cross-references

### Workflow/CI Generation Rules
- **NEVER** generate CI/CD workflows without current API validation
- **ALWAYS** check `__init__.py` exports before writing import statements
- **VERIFY** against examples/ directory for current usage patterns
- **TEST** generated code against current codebase

### Case Study Prevention
1. **API Drift**: The 2025-09-02 HoneyHiveClient failure demonstrates why validation is MANDATORY
2. **Documentation Errors**: The 2025-01-30 documentation cleanup required fixing 23+ warnings
   - RST formatting issues, broken code blocks, type safety violations
   - Solution: Automated validation prevents these errors entirely
