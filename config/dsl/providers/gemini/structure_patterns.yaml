version: '1.0'
provider: gemini
dsl_type: provider_structure_patterns

# Gemini Structure Patterns for Universal LLM Discovery Engine v4.0
# This file defines patterns for detecting Google Gemini spans from various instrumentors
# Updated for 2025-09-29 with current Gemini model support

patterns:
  
  # === OpenInference Gemini Pattern ===
  openinference_gemini:
    signature_fields:
      - "llm.model_name"
      - "llm.provider"
      - "llm.input_messages"
      - "llm.token_count.prompt"
      - "llm.invocation_parameters.candidate_count"
    optional_fields:
      - "llm.output_messages"
      - "llm.invocation_parameters.temperature"
      - "llm.invocation_parameters.max_output_tokens"
      - "llm.invocation_parameters.top_p"
      - "llm.invocation_parameters.top_k"
      - "llm.invocation_parameters.safety_settings"
    confidence_weight: 0.98
    description: "OpenInference semantic conventions for Google Gemini"
    model_patterns:
      - "gemini-*"
      - "gemini-1.5-*"
      - "gemini-1.0-*"
    provider_indicators:
      - "google"
      - "gemini"
    
  # === Traceloop Gemini Pattern ===
  traceloop_gemini:
    signature_fields:
      - "gen_ai.request.model"
      - "gen_ai.system"
      - "gen_ai.usage.prompt_tokens"
      - "gen_ai.completion"
      - "gen_ai.request.candidate_count"
    optional_fields:
      - "gen_ai.request.temperature"
      - "gen_ai.request.max_tokens"
      - "gen_ai.request.top_p"
      - "gen_ai.request.top_k"
      - "gen_ai.usage.completion_tokens"
      - "gen_ai.response.finish_reason"
      - "gen_ai.request.safety_settings"
    confidence_weight: 0.95
    description: "Traceloop OpenLLMetry conventions for Google Gemini"
    model_patterns:
      - "gemini-*"
      - "gemini-1.5-*"
      - "gemini-1.0-*"
    provider_indicators:
      - "google"
      - "gemini"
    
  # === Direct Google AI SDK Pattern ===
  direct_gemini:
    signature_fields:
      - "gemini.model"
      - "gemini.contents"
      - "gemini.response"
      - "gemini.generation_config"
    optional_fields:
      - "gemini.usage_metadata.prompt_token_count"
      - "gemini.usage_metadata.candidates_token_count"
      - "gemini.safety_settings"
      - "gemini.system_instruction"
      - "gemini.tools"
    confidence_weight: 0.90
    description: "Direct Google AI SDK usage patterns"
    model_patterns:
      - "gemini-*"
      - "gemini-1.5-*"
      - "gemini-1.0-*"
    provider_indicators:
      - "google"
      - "gemini"
    
  # === LangChain Gemini Pattern ===
  langchain_gemini:
    signature_fields:
      - "langchain.llm.model_name"
      - "langchain.llm.provider"
      - "langchain.llm.input"
      - "langchain.gemini.candidate_count"
    optional_fields:
      - "langchain.llm.output"
      - "langchain.llm.token_usage.prompt_tokens"
      - "langchain.llm.token_usage.completion_tokens"
      - "langchain.llm.parameters.temperature"
      - "langchain.llm.parameters.max_tokens"
      - "langchain.gemini.safety_settings"
    confidence_weight: 0.85
    description: "LangChain Gemini integration patterns"
    model_patterns:
      - "gemini-*"
      - "gemini-1.5-*"
      - "gemini-1.0-*"
    provider_indicators:
      - "google"
      - "gemini"
    
  # === Vertex AI Gemini Pattern ===
  vertex_ai_gemini:
    signature_fields:
      - "vertex_ai.model"
      - "vertex_ai.project_id"
      - "vertex_ai.location"
      - "vertex_ai.request"
    optional_fields:
      - "vertex_ai.response"
      - "vertex_ai.usage.input_tokens"
      - "vertex_ai.usage.output_tokens"
      - "vertex_ai.safety_ratings"
      - "vertex_ai.generation_config"
    confidence_weight: 0.80
    description: "Vertex AI Gemini service patterns"
    model_patterns:
      - "gemini-*"
      - "gemini-1.5-*"
      - "gemini-1.0-*"
    provider_indicators:
      - "google"
      - "vertex_ai"
      - "gemini"
    
  # === Generic Google AI Pattern ===
  generic_google_ai:
    signature_fields:
      - "ai.model.provider"
      - "ai.model.name"
      - "ai.request.messages"
      - "ai.google.candidate_count"
    optional_fields:
      - "ai.response.messages"
      - "ai.usage.input_tokens"
      - "ai.usage.output_tokens"
      - "ai.request.temperature"
      - "ai.request.max_tokens"
      - "ai.google.safety_settings"
    confidence_weight: 0.75
    description: "Generic AI instrumentation patterns for Google Gemini"
    model_patterns:
      - "gemini-*"
      - "gemini-1.5-*"
      - "gemini-1.0-*"
    provider_indicators:
      - "google"
      - "gemini"

validation:
  minimum_signature_fields: 3
  maximum_patterns: 10
  confidence_threshold: 0.7
  required_model_patterns:
    - "gemini-*"
  supported_models:
    # Gemini 1.5 models (current flagship - 2025-09-29)
    - "gemini-1.5-pro-002"
    - "gemini-1.5-pro-001"
    - "gemini-1.5-pro"
    - "gemini-1.5-flash-002"
    - "gemini-1.5-flash-001"
    - "gemini-1.5-flash"
    - "gemini-1.5-flash-8b"
    
    # Gemini 1.0 models
    - "gemini-1.0-pro-002"
    - "gemini-1.0-pro-001"
    - "gemini-1.0-pro"
    - "gemini-1.0-pro-vision"
    
    # Legacy models
    - "gemini-pro"
    - "gemini-pro-vision"
    - "gemini-ultra"
    
  instrumentor_compatibility:
    openinference: ["0.1.15", "0.1.16", "0.1.17"]
    traceloop: ["0.46.2", "0.47.0", "0.48.0"]
    langchain: ["0.1.0", "0.2.0"]
    vertex_ai: ["1.0.0", "1.1.0"]
