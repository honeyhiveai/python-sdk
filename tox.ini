[tox]
envlist = py310, py311, py312
isolated_build = True
requires = tox>=4.0

[testenv]
description = run tests with pytest
deps =
    pytest>=8.1.1
    pytest-cov
    pytest-asyncio
    httpx>=0.27.0
    pydantic>=2.10.0
    opentelemetry-api>=1.21.0
    opentelemetry-sdk>=1.21.0
    opentelemetry-exporter-otlp-proto-http>=1.21.0
    opentelemetry-instrumentation>=0.42b0
    rich>=13.9.4
    pyyaml>=6.0.1
    requests>=2.25.1
    python-dateutil>=2.8.2
    typing-inspect>=0.9.0
    dataclasses-json>=0.6.7
    wrapt>=1.16.0
    jsonpath-python>=1.0.6
    uplink>=0.1.0
    eval-type-backport>=0.2.0
    jinja2
    openai
    llama-index
    langchain
commands =
    pytest {posargs:tests} --cov=src/honeyhive --cov-report=term-missing --cov-report=html
    pytest {posargs:tests} --cov=src/honeyhive --cov-report=xml
setenv =
    PYTHONPATH = {toxinidir}/src
    PYTHONUNBUFFERED = 1



[testenv:py310]
description = run tests with Python 3.10
basepython = python3.10
deps = {[testenv]deps}

[testenv:py311]
description = run tests with Python 3.11
basepython = python3.11
deps = {[testenv]deps}

[testenv:py312]
description = run tests with Python 3.12
basepython = python3.12
deps = {[testenv]deps}

[testenv:lint]
description = run linting checks
deps =
    pylint==3.2.3
    mypy==1.10.1
    types-python-dateutil>=2.9.0.20240316
commands =
    pylint src/honeyhive tests --rcfile=pylintrc
    mypy src/honeyhive --config-file=pyproject.toml

[testenv:format]
description = check code formatting
deps =
    black
    isort
commands =
    black --check src tests
    isort --check-only src tests

[testenv:docs]
description = build documentation
deps =
    sphinx
    sphinx-rtd-theme
commands =
    sphinx-build -b html docs docs/_build/html

[flake8]
max-line-length = 100
exclude = .git,__pycache__,.venv,dist,build,*.egg-info

[coverage:run]
source = src/honeyhive
omit = 
    */tests/*
    */test_*
    */__pycache__/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    if self.debug:
    if settings.DEBUG
    raise AssertionError
    raise NotImplementedError
    if 0:
    if __name__ == .__main__.:
    class .*\bProtocol\):
    @(abc\.)?abstractmethod
