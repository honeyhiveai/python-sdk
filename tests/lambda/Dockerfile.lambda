# Custom Lambda container with HoneyHive SDK pre-installed
FROM public.ecr.aws/lambda/python:3.11

# Create honeyhive directory structure
RUN mkdir -p ${LAMBDA_TASK_ROOT}/honeyhive

# Copy Lambda test functions first
COPY lambda_functions/ ${LAMBDA_TASK_ROOT}/

# Install Python dependencies for the SDK
RUN pip install --no-cache-dir \
    opentelemetry-api \
    opentelemetry-sdk \
    opentelemetry-exporter-otlp \
    opentelemetry-instrumentation \
    opentelemetry-propagator-b3 \
    opentelemetry-propagator-jaeger \
    opentelemetry-propagator-aws-xray \
    requests \
    pydantic

# Create a minimal version of the honeyhive package structure for testing
RUN echo "# HoneyHive SDK stub for Lambda testing" > ${LAMBDA_TASK_ROOT}/honeyhive/__init__.py

# Set the default handler
CMD ["basic_tracing.lambda_handler"]
